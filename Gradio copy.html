<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" crossorigin src="https://cdn.jsdelivr.net/npm/@gradio/lite/dist/lite.js"></script>
    <script type="text/javascript">
        let zipResponse = await fetch("myfiles.zip");
        let zipBinary = await zipResponse.arrayBuffer();
        pyodide.unpackArchive(zipBinary, "zip");
        let file = pyodide.FS.readFile("/decision_tree_model.joblib", { encoding: "utf8" });
        // const decisiontree = await fetch("decision_tree_model.joblib");
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gradio/lite/dist/lite.css" />
    <link rel="shortcut icon" type="image/png" href="image/calc.png" />
    <title>ATECO Max Demand Predictor</title>
</head>

<body>
    <gradio-lite theme="dark">

import micropip
await micropip.install('joblib')
import gradio as gr
import joblib as joblib
import numpy as np
import zipfile
import os
import js
<!-- from pathlib import Path

decision_tree_model = joblib.load(Path("/decision_tree_model.joblib")) -->

<!-- with open("/decision_tree_model.joblib", "w") -->
decision_tree_model = joblib.load(file)
<!--  decision_tree_model = joblib.load('decision_tree_model.joblib')
random_forest_model = joblib.load('random_forest_model.joblib')
linear_regression_model = joblib.load('linear_model.joblib')
polynomial_regression_model = joblib.load('polynomial_model.joblib')
svm_model = joblib.load('svm_model.joblib') -->

print(os.listdir())


        # Function to generate prediction using Decision Tree
def generate_decision_tree_prediction(imports, renewables_production, powerplants_c02, gdp, population, tmin,tavg, tmax):
    model = decision_tree_model
    input_data = np.array([[imports, renewables_production, powerplants_c02, gdp, population, tmin, tavg, tmax]])
    prediction = model.predict(input_data)[0]
    return prediction


        # Function to generate prediction using Random Forest
def generate_random_forest_prediction(imports, renewables_production, powerplants_c02, gdp, population, tmin, tavg, tmax):
    model = random_forest_model
    input_data = np.array([[imports, renewables_production, powerplants_c02, gdp, population, tmin, tavg, tmax]])
    prediction = model.predict(input_data)[0]
    return prediction

        # Function to generate prediction using SVM
def generate_svm_prediction(plant_production, population, tmax): 
    model = svm_model
    input_data = np.array([[plant_production, population, tmax]])
    prediction = model.predict(input_data)[0]
    return prediction

        # Function to generate prediction using Linear Regression
def generate_linear_prediction(plant_production, population, tmax):
    model = linear_regression_model
    input_data = np.array([[plant_production, population, tmax]])
    prediction = model.predict(input_data)[0]
    return prediction

        # Function to generate prediction using Polynomial Regression
def generate_polynomial_prediction(plant_production, population, tmax):
    model = polynomial_regression_model
    input_data = np.array([[plant_production, population, tmax]])
    prediction = model.predict(input_data)[0]
    return prediction

        #DT Interface
decision = gr.Interface(
    fn=generate_decision_tree_prediction,
    inputs=[
        gr.Number(label="Imports (GWh)"),
        gr.Number(label="Renewables Production (GWh)"),
        gr.Number(label="Powerplants CO2 Emissions (kt)"),
        gr.Number(label="GDP (mln)"),
        gr.Number(label="Population (k)"),
        gr.Number(label="Min Temperature (°C)"),
        gr.Number(label="Average Temperature (°C)"),
        gr.Number(label="Max Temperature (°C)"),
    ],
    outputs="number",
    live=True,
    title="Decision Tree Prediction",
    description="Enter features to get the predicted Max Demand.",
    #examples=data_with_model_type
)


#RF Interface
random = gr.Interface(
    fn=generate_random_forest_prediction,
    inputs=[
        gr.Number(label="Imports (GWh)"),
        gr.Number(label="Renewables Production (GWh)"),
        gr.Number(label="Powerplants CO2 Emissions (kt)"),
        gr.Number(label="GDP (mln)"),
        gr.Number(label="Population (k)"),
        gr.Number(label="Min Temperature (°C)"),
        gr.Number(label="Average Temperature (°C)"),
        gr.Number(label="Max Temperature (°C)"),
    ],
    outputs="number",
    live=True,
    title="Random Forest Prediction",
    description="Enter features to get the predicted Max Demand.",
    #examples=data_with_model_type
)



#SVM Interface
svm = gr.Interface(
    fn=generate_svm_prediction,
    inputs=[
        gr.Number(label="Plant Production (GWh)"),
        gr.Number(label="Population (k)"),
        gr.Number(label="Max Temperature (°C)"),
    ],
    outputs="number",
    live=True,
    title="SVM Prediction",
    description="Enter features to get the predicted Max Demand.",
    #examples=data_with_model_type
)


#Linear Regression Interface
linear = gr.Interface(
    fn=generate_linear_prediction,
    inputs=[
        gr.Number(label="Plant Production (GWh)"),
        gr.Number(label="Population (k)"),
        gr.Number(label="Max Temperature (°C)"),
    ],
    outputs="number",
    live=True,
    title="Linear Regression Prediction",
    description="Enter features to get the predicted Max Demand.",
    #examples=data_with_model_type
)

#Polynomial Regression Interface
polynomial = gr.Interface(
    fn=generate_polynomial_prediction,
    inputs=[
        gr.Number(label="Plant Production (GWh)"),
        gr.Number(label="Population (k)"),
        gr.Number(label="Max Temperature (°C)"),
    ],
    outputs="number",
    live=True,
    analytics_enabled=True,
    title="Polynomial Regression Prediction",
    description="Enter features to get the predicted Max Demand.",
    #examples=data_with_model_type
)


demo = gr.TabbedInterface([decision,random,svm,linear,polynomial], ["Decision Tree", "Random Forest","SVM", "Linear Regression", "Polynomial Regression"])

demo.launch()

    </gradio-lite>

</body>

</html>